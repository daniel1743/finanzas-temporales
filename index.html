<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">

    <!-- Primary Meta Tags -->
    <title>üí∞ Finanzas Mensuales - Control de Gastos</title>
    <meta name="title" content="üí∞ Finanzas Mensuales - Control de Gastos">
    <meta name="description" content="Control completo de tus finanzas personales. Gestiona ingresos, gastos y visualiza estad√≠sticas en tiempo real.">

    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#1E3A8A">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Finanzas">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">

    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="public/icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="public/icon-512.png">
    <link rel="apple-touch-icon" href="public/icon-192.png">
    <link rel="shortcut icon" href="public/icon-192.png">

    <!-- Styles -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="css/responsive-pwa.css">
    <link rel="stylesheet" href="css/dashboard-enhanced.css">
    <link rel="stylesheet" href="css/sidebar-menu.css">
    <link rel="stylesheet" href="css/navbar.css">
    <link rel="stylesheet" href="css/historial.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Overlay para cerrar sidebar en m√≥vil -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- Bot√≥n hamburguesa para m√≥vil -->
    <button class="menu-toggle" id="menuToggle">
        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="3" y1="12" x2="21" y2="12"></line>
            <line x1="3" y1="6" x2="21" y2="6"></line>
            <line x1="3" y1="18" x2="21" y2="18"></line>
        </svg>
    </button>

    <!-- Sidebar - Men√∫ lateral -->
    <aside class="app-sidebar" id="appSidebar">
        <div class="sidebar-header">
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">üí∞</div>
                <div class="sidebar-logo-text">
                    <h1>Finanzas</h1>
                    <p>Control de gastos</p>
                </div>
            </div>
        </div>

        <nav class="sidebar-nav">
            <a class="sidebar-nav-item active" data-nav="dashboard">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                </svg>
                <span class="nav-label">Dashboard</span>
            </a>

            <a class="sidebar-nav-item" data-nav="registro">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                </svg>
                <span class="nav-label">Registro</span>
            </a>

            <a class="sidebar-nav-item" data-nav="transacciones">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
                <span class="nav-label">Transacciones</span>
            </a>

            <a class="sidebar-nav-item" data-nav="historial">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span class="nav-label">Historial</span>
            </a>

            <a class="sidebar-nav-item" data-nav="configuracion">
                <svg class="nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span class="nav-label">Configuraci√≥n</span>
            </a>
        </nav>
    </aside>

    <!-- Bottom Navigation - M√≥vil -->
    <nav class="bottom-nav" id="bottomNav">
        <div class="bottom-nav-container">
            <a class="bottom-nav-item active" data-nav="dashboard">
                <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 13h8V3H3v10zm0 8h8v-6H3v6zm10 0h8V11h-8v10zm0-18v6h8V3h-8z"/>
                </svg>
                <span class="bottom-nav-label">Dashboard</span>
            </a>

            <a class="bottom-nav-item" data-nav="registro">
                <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2m-6 9l2 2 4-4"/>
                </svg>
                <span class="bottom-nav-label">Registro</span>
            </a>

            <a class="bottom-nav-item" data-nav="transacciones">
                <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"/>
                </svg>
                <span class="bottom-nav-label">Transacciones</span>
            </a>

            <a class="bottom-nav-item" data-nav="historial">
                <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                <span class="bottom-nav-label">Historial</span>
            </a>

            <a class="bottom-nav-item" data-nav="configuracion">
                <svg class="bottom-nav-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
                <span class="bottom-nav-label">Config</span>
            </a>
        </div>
    </nav>

    <!-- Navbar Superior -->
    <nav class="top-navbar">
        <div class="navbar-left">
            <h1 class="navbar-title">Finanzas Personales</h1>
            <p class="navbar-subtitle">Lleva tu control personal</p>
        </div>

        <div class="navbar-right">
            <div class="navbar-profile">
                <div class="profile-photo-container" id="profilePhotoContainer">
                    <img id="navbarProfilePhoto" class="profile-photo" src="" alt="Foto de perfil" style="display: none;">
                    <div id="navbarProfilePlaceholder" class="profile-photo-placeholder">
                        üë§
                    </div>
                    <input type="file" id="navbarPhotoUpload" class="upload-photo-input" accept="image/*">
                </div>
            </div>

            <div class="navbar-actions">
                <button class="navbar-action-btn login-btn" id="navbarLoginBtn" data-tooltip="Iniciar sesi√≥n">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M15 3h4a2 2 0 012 2v14a2 2 0 01-2 2h-4M10 17l5-5-5-5M15 12H3"/>
                    </svg>
                </button>

                <div class="navbar-dropdown-container" id="navbarDropdownContainer" style="display: none;">
                    <button class="navbar-action-btn menu-btn" id="navbarMenuBtn" data-tooltip="Men√∫">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="1"/>
                            <circle cx="12" cy="5" r="1"/>
                            <circle cx="12" cy="19" r="1"/>
                        </svg>
                    </button>

                    <!-- Men√∫ desplegable -->
                    <div class="navbar-dropdown" id="navbarDropdown">
                        <div class="dropdown-header">
                            <div class="dropdown-user-info">
                                <div class="dropdown-avatar">
                                    <img id="dropdownAvatar" src="" alt="Avatar" style="display: none;">
                                    <div id="dropdownAvatarPlaceholder">üë§</div>
                                </div>
                                <div class="dropdown-user-details">
                                    <p class="dropdown-user-name" id="dropdownUserName">Usuario</p>
                                    <p class="dropdown-user-email" id="dropdownUserEmail">usuario@email.com</p>
                                </div>
                            </div>
                        </div>

                        <div class="dropdown-divider"></div>

                        <div class="dropdown-menu">
                            <button class="dropdown-item" id="dropdownChangePhoto">
                                <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z"/>
                                    <circle cx="12" cy="13" r="4"/>
                                </svg>
                                <span>Cambiar foto</span>
                            </button>

                            <button class="dropdown-item" id="dropdownChangeName">
                                <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2"/>
                                    <circle cx="12" cy="7" r="4"/>
                                </svg>
                                <span>Cambiar nombre</span>
                            </button>

                            <button class="dropdown-item" id="dropdownSettings">
                                <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 15a3 3 0 100-6 3 3 0 000 6z"/>
                                    <path d="M19.4 15a1.65 1.65 0 00.33 1.82l.06.06a2 2 0 010 2.83 2 2 0 01-2.83 0l-.06-.06a1.65 1.65 0 00-1.82-.33 1.65 1.65 0 00-1 1.51V21a2 2 0 01-2 2 2 2 0 01-2-2v-.09A1.65 1.65 0 009 19.4a1.65 1.65 0 00-1.82.33l-.06.06a2 2 0 01-2.83 0 2 2 0 010-2.83l.06-.06a1.65 1.65 0 00.33-1.82 1.65 1.65 0 00-1.51-1H3a2 2 0 01-2-2 2 2 0 012-2h.09A1.65 1.65 0 004.6 9a1.65 1.65 0 00-.33-1.82l-.06-.06a2 2 0 010-2.83 2 2 0 012.83 0l.06.06a1.65 1.65 0 001.82.33H9a1.65 1.65 0 001-1.51V3a2 2 0 012-2 2 2 0 012 2v.09a1.65 1.65 0 001 1.51 1.65 1.65 0 001.82-.33l.06-.06a2 2 0 012.83 0 2 2 0 010 2.83l-.06.06a1.65 1.65 0 00-.33 1.82V9a1.65 1.65 0 001.51 1H21a2 2 0 012 2 2 2 0 01-2 2h-.09a1.65 1.65 0 00-1.51 1z"/>
                                </svg>
                                <span>Ajustes</span>
                            </button>

                            <div class="dropdown-divider"></div>

                            <button class="dropdown-item danger" id="dropdownResetData">
                                <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 6h18M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6m3 0V4a2 2 0 012-2h4a2 2 0 012 2v2"/>
                                    <path d="M10 11v6M14 11v6"/>
                                </svg>
                                <span>Reiniciar Todos los Datos</span>
                            </button>

                            <button class="dropdown-item danger" id="dropdownLogout">
                                <svg class="dropdown-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9"/>
                                </svg>
                                <span>Cerrar sesi√≥n</span>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="app-content">
    <!-- Header Global -->
    <header class="app-header">
        <div class="header-content">
            <div class="header-left">
                <h1 class="app-title">üí∞ Finanzas Mensuales</h1>
                <p class="app-subtitle">Control completo de tus finanzas personales</p>
            </div>
            <div class="header-right">
                <div class="user-selector">
                    <label for="currentUser">Usuario:</label>
                    <select id="currentUser" class="form-control">
                        <option value="1">Daniel</option>
                        <option value="2">Pareja</option>
                        <option value="new">+ Agregar nuevo usuario</option>
                    </select>
                </div>
            </div>
        </div>
    </header>

    <!-- Navigation Tabs -->
    <nav class="app-nav">
        <button class="nav-tab active" data-tab="dashboard">üìä Dashboard</button>
        <button class="nav-tab" data-tab="registro">üìù Registro</button>
        <button class="nav-tab" data-tab="transacciones">üí≥ Transacciones</button>
        <button class="nav-tab" data-tab="historial">üìú Historial</button>
        <button class="nav-tab" data-tab="configuracion">‚öôÔ∏è Configuraci√≥n</button>
    </nav>

    <!-- Main Content -->
    <main class="app-content">
        <!-- Tab 1: REGISTRO -->
        <section id="registro" class="tab-content">
            <div class="section-header">
                <h2>üí∞ Registro de Gastos e Ingresos</h2>
                <p>Lleva el control de tus finanzas de manera sencilla y r√°pida.</p>
            </div>

            <div class="form-container">
                <form id="registroForm">
                    <!-- Ingresos -->
                    <div class="form-section">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">
                            <h3 style="margin: 0;">üíµ Ingresos del Mes</h3>
                            <button type="button" id="btnAgregarIngreso" class="btn btn--primary" style="font-size: 0.875rem; padding: 0.5rem 1rem;">
                                ‚ûï Agregar Ingreso
                            </button>
                        </div>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="ingresoBase" class="form-label">Ingreso Principal *</label>
                                <input type="number" id="ingresoBase" class="form-control" placeholder="$0" min="0">
                            </div>
                            <div class="form-group">
                                <label for="ingresoExtra" class="form-label">Ingreso Extra</label>
                                <input type="number" id="ingresoExtra" class="form-control" placeholder="$0" min="0">
                            </div>
                        </div>
                        <div id="ingresosAgregados" style="margin-top: 1rem; padding: 1rem; background: #f3f4f6; border-radius: 0.5rem; display: none;">
                            <p style="font-weight: 600; color: #374151; margin-bottom: 0.5rem;">üìä Ingresos acumulados:</p>
                            <p style="color: #6b7280; margin: 0;">
                                <strong>Total de ingresos agregados:</strong> <span id="totalIngresosAcumulados" style="color: #059669; font-weight: 700;">$0</span>
                            </p>
                        </div>
                    </div>

                    <!-- Gastos -->
                    <div class="form-section">
                        <h3>üí∏ Registrar Gasto</h3>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="montoGasto" class="form-label">Monto del Gasto *</label>
                                <input type="number" id="montoGasto" class="form-control" placeholder="$0" min="0" required>
                            </div>
                            <div class="form-group">
                                <label for="descripcionGasto" class="form-label">Descripci√≥n *</label>
                                <input type="text" id="descripcionGasto" class="form-control" placeholder="Ej: Supermercado" list="descripcionesSugeridasPrincipal" autocomplete="off" required>
                                <datalist id="descripcionesSugeridasPrincipal"></datalist>
                            </div>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label for="categoria" class="form-label">Categor√≠a *</label>
                                <select id="categoria" class="form-control" required>
                                    <option value="">Seleccionar...</option>
                                    <option value="Alimentaci√≥n üçû">Alimentaci√≥n üçû</option>
                                    <option value="Transporte üöó">Transporte üöó</option>
                                    <option value="Entretenimiento üé¨">Entretenimiento üé¨</option>
                                    <option value="Salud üíä">Salud üíä</option>
                                    <option value="Educaci√≥n üìö">Educaci√≥n üìö</option>
                                    <option value="Otro ‚ûï">Otro ‚ûï</option>
                                    <option value="nueva">+ Agregar nueva categor√≠a</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="fechaGasto" class="form-label">Fecha *</label>
                                <input type="date" id="fechaGasto" class="form-control" required>
                            </div>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Nivel de Necesidad *</label>
                            <div class="necessity-buttons">
                                <button type="button" class="necessity-btn" data-level="Baja">Baja</button>
                                <button type="button" class="necessity-btn" data-level="Media">Media</button>
                                <button type="button" class="necessity-btn" data-level="Alta">Alta</button>
                                <button type="button" class="necessity-btn" data-level="Cr√≠tica">Cr√≠tica</button>
                                <button type="button" class="necessity-btn-add" id="addNecesidad">+ Agregar personalizada</button>
                            </div>
                        </div>

                        <div class="form-group">
                            <label for="usuarioGasto" class="form-label">Usuario *</label>
                            <select id="usuarioGasto" class="form-control" required>
                                <option value="Daniel">Daniel</option>
                                <option value="Pareja">Pareja</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="items" class="form-label">Items de compra (opcional)</label>
                            <textarea id="items" class="form-control" rows="3" placeholder="Ej: Arroz, Aceite, Pan..."></textarea>
                        </div>

                        <div class="form-group">
                            <label for="notas" class="form-label">Notas adicionales (opcional)</label>
                            <textarea id="notas" class="form-control" rows="3" placeholder="Cualquier informaci√≥n adicional..."></textarea>
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="submit" class="btn btn--primary">Registrar Gasto</button>
                        <button type="button" id="limpiarForm" class="btn btn--secondary">Limpiar Campos</button>
                    </div>
                </form>
            </div>
        </section>

        <!-- Tab 2: DASHBOARD -->
        <section id="dashboard" class="tab-content active">
            <div class="dashboard-header">
                <div class="user-profile">
                    <div class="user-avatar">
                        <img id="userAvatar" src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='80' height='80' viewBox='0 0 80 80'%3E%3Ccircle cx='40' cy='40' r='40' fill='%231E3A8A'/%3E%3Ctext x='50%25' y='50%25' text-anchor='middle' dy='.3em' fill='white' font-size='32' font-family='Arial'%3Eüë§%3C/text%3E%3C/svg%3E" alt="Usuario">
                    </div>
                    <div class="user-info">
                        <h2 id="userGreeting">Hola, Usuario üëã</h2>
                        <p id="monthInfo">Tus finanzas de octubre van as√≠:</p>
                    </div>
                </div>
            </div>

            <!-- Tarjetas de estad√≠sticas principales -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-icon stat-icon-1">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm.31-8.86c-1.77-.45-2.34-.94-2.34-1.67 0-.84.79-1.43 2.1-1.43 1.38 0 1.9.66 1.94 1.64h1.71c-.05-1.34-.87-2.57-2.49-2.97V5H10.9v1.69c-1.51.32-2.72 1.3-2.72 2.81 0 1.79 1.49 2.69 3.66 3.21 1.95.46 2.34 1.15 2.34 1.87 0 .53-.39 1.39-2.1 1.39-1.6 0-2.23-.72-2.32-1.64H8.04c.1 1.7 1.36 2.66 2.86 2.97V19h2.34v-1.67c1.52-.29 2.72-1.16 2.73-2.77-.01-2.2-1.9-2.96-3.66-3.42z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-header">
                            <h3>Balance General</h3>
                            <button class="toggle-details" data-card="balance">‚ñº</button>
                        </div>
                        <div class="stat-value" id="balanceGeneral">$0</div>
                        <div class="stat-details" id="balanceDetails" style="display: none;">
                            <p><strong>Ingresos totales:</strong> <span id="ingresosTotal">$0</span></p>
                            <p><strong>Gastos totales:</strong> <span id="gastosTotal">$0</span></p>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-icon-2">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                            <path d="M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2zM1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2H1zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-header">
                            <h3>Total Gastado</h3>
                            <button class="toggle-details" data-card="gastado">‚ñº</button>
                        </div>
                        <div class="stat-value" id="totalGastado">$0</div>
                        <div class="stat-details" id="gastadoDetails" style="display: none;">
                            <div id="gastadoPorCategoria"></div>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-icon-3">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                            <path d="M16 6l2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-header">
                            <h3>Lo que te queda</h3>
                            <button class="toggle-details" data-card="queda">‚ñº</button>
                        </div>
                        <div class="stat-value" id="loQueQueda">$0</div>
                        <div class="stat-details" id="quedaDetails" style="display: none;">
                            <div id="progressBar" class="progress-bar">
                                <div id="progressFill" class="progress-fill"></div>
                            </div>
                            <p id="progressText">0% del presupuesto utilizado</p>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-icon-4">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                            <path d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-header">
                            <h3>Promedio Diario</h3>
                            <button class="toggle-details" data-card="promedio">‚ñº</button>
                        </div>
                        <div class="stat-value" id="promedioDiario">$0</div>
                        <div class="stat-details" id="promedioDetails" style="display: none;">
                            <p><strong>D√≠as transcurridos:</strong> <span id="diasMes">0</span></p>
                            <p><strong>Proyecci√≥n mensual:</strong> <span id="proyeccionMensual">$0</span></p>
                        </div>
                    </div>
                </div>

                <div class="stat-card stat-card-wide">
                    <div class="stat-icon stat-icon-5">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                            <path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-header">
                            <h3>üìú √öltimos Movimientos</h3>
                            <button class="toggle-details" data-card="movimientos">‚ñº</button>
                        </div>
                        <div class="stat-value" style="font-size: 1.2rem;" id="ultimosMovimientosResumen">Sin movimientos</div>
                        <div class="stat-details" id="movimientosDetails" style="display: none;">
                            <div id="miniHistorial" class="mini-historial">
                                <p class="no-data">No hay movimientos registrados</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-icon stat-icon-6">
                        <svg width="32" height="32" viewBox="0 0 24 24" fill="white">
                            <path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/>
                        </svg>
                    </div>
                    <div class="stat-content">
                        <div class="stat-header">
                            <h3>Total de Transacciones</h3>
                            <button class="toggle-details" data-card="transacciones">‚ñº</button>
                        </div>
                        <div class="stat-value" id="totalTransacciones">0</div>
                        <div class="stat-details" id="transaccionesDetails" style="display: none;">
                            <p><strong>Transacci√≥n m√°s alta:</strong> <span id="transaccionMaxima">$0</span></p>
                            <p><strong>Transacci√≥n m√°s baja:</strong> <span id="transaccionMinima">$0</span></p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recomendaciones Inteligentes -->
            <div id="smartInsightsContainer" class="insights-section" style="margin: 24px 0;"></div>

            <!-- Gr√°ficos principales -->
            <div class="charts-container">
                <div class="chart-card">
                    <h3>üìä Gastos por Categor√≠a</h3>
                    <div class="chart-wrapper">
                        <canvas id="chartPie"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>üìä Gastos Necesarios vs Innecesarios</h3>
                    <div class="chart-wrapper">
                        <canvas id="chartBar"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>üìä Nivel de Necesidad</h3>
                    <div class="chart-wrapper">
                        <canvas id="chartRadar"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <h3>üìä Balance de Gastos vs Ingresos</h3>
                    <div class="chart-wrapper">
                        <canvas id="chartBalanceDoughnut"></canvas>
                    </div>
                </div>

                <div class="chart-card full-width">
                    <h3>üìä Evoluci√≥n Diaria de Gastos</h3>
                    <div class="chart-wrapper">
                        <canvas id="chartLine"></canvas>
                    </div>
                </div>

                <div class="chart-card full-width">
                    <h3>üìä Comparaci√≥n de Gastos por Usuario</h3>
                    <div class="chart-wrapper">
                        <canvas id="chartUserComparison"></canvas>
                    </div>
                </div>
            </div>
        </section>

        <!-- Tab 3: TRANSACCIONES -->
        <section id="transacciones" class="tab-content">
            <div class="section-header">
                <h2>üí≥ Transacciones</h2>
                <p>Lista completa y filtrable de todas tus transacciones</p>
            </div>

            <div class="filters-container">
                <div class="filter-group">
                    <label>Fecha desde:</label>
                    <input type="date" id="filterFechaDesde" class="form-control">
                </div>
                <div class="filter-group">
                    <label>Fecha hasta:</label>
                    <input type="date" id="filterFechaHasta" class="form-control">
                </div>
                <div class="filter-group">
                    <label>Monto m√≠nimo:</label>
                    <input type="number" id="filterMontoMin" class="form-control" placeholder="$0">
                </div>
                <div class="filter-group">
                    <label>Monto m√°ximo:</label>
                    <input type="number" id="filterMontoMax" class="form-control" placeholder="$0">
                </div>
                <div class="filter-group">
                    <label>Categor√≠a:</label>
                    <select id="filterCategoria" class="form-control">
                        <option value="">Todas</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>Usuario:</label>
                    <select id="filterUsuario" class="form-control">
                        <option value="">Todos</option>
                    </select>
                </div>
                <div class="filter-actions">
                    <button id="aplicarFiltros" class="btn btn--primary btn--sm">Aplicar Filtros</button>
                    <button id="limpiarFiltros" class="btn btn--secondary btn--sm">Limpiar</button>
                </div>
            </div>

            <div class="table-container">
                <table id="transaccionesTable" class="transactions-table">
                    <thead>
                        <tr>
                            <th>Fecha</th>
                            <th>Usuario</th>
                            <th>Descripci√≥n</th>
                            <th>Categor√≠a</th>
                            <th>Necesidad</th>
                            <th>Monto</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody id="transaccionesBody">
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 2rem;">No hay transacciones registradas</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Tab 4: HISTORIAL -->
        <section id="historial" class="tab-content">
            <div class="section-header">
                <h2>üìú Historial</h2>
                <p>Hist√≥rico completo de tus finanzas</p>
            </div>

            <div class="history-section">
                <h3>üìÖ Mes Actual</h3>
                <div id="mesActualContent" class="history-content">
                    <p class="no-data">No hay datos del mes actual</p>
                </div>
                <div id="resumenActual" class="history-summary"></div>
            </div>

            <div class="history-section">
                <h3>üìÖ Mes Anterior</h3>
                <div id="mesAnteriorContent" class="history-content">
                    <p class="no-data">No hay datos del mes anterior</p>
                </div>
                <div id="resumenAnterior" class="history-summary"></div>
            </div>

            <div class="export-section">
                <button id="exportarCSV" class="btn btn--primary">üì• Exportar Historial a CSV</button>
            </div>
        </section>

        <!-- Tab 5: CONFIGURACI√ìN -->
        <section id="configuracion" class="tab-content">
            <div class="section-header">
                <h2>‚öôÔ∏è Configuraci√≥n</h2>
                <p>Personaliza tu experiencia</p>
            </div>

            <div class="config-container">
                <div class="config-section">
                    <h3>üë§ Perfil de Usuario</h3>
                    <div class="form-group">
                        <label class="form-label">Foto de perfil</label>
                        <input type="file" id="uploadFoto" class="form-control" accept="image/*">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Nombre</label>
                        <input type="text" id="configNombre" class="form-control" placeholder="Tu nombre">
                    </div>
                    <button id="guardarPerfil" class="btn btn--primary">Guardar Perfil</button>
                </div>

                <div class="config-section">
                    <h3>üîî Notificaciones</h3>
                    <p>Configura recordatorios para registrar tus gastos diarios</p>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="enableNotifications" style="margin-right: 8px;">
                            Habilitar notificaciones diarias
                        </label>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Hora del recordatorio</label>
                        <input type="time" id="reminderTime" class="form-control" value="20:00">
                    </div>
                    <button id="saveNotificationSettings" class="btn btn--primary">Guardar Configuraci√≥n</button>
                    <button id="testNotification" class="btn btn--secondary" style="margin-left: 8px;">Probar Notificaci√≥n</button>
                </div>

                <div class="config-section">
                    <h3>üí± Moneda</h3>
                    <p><strong>Moneda actual:</strong> Peso Chileno (CLP)</p>
                    <p style="color: #6b7280; font-size: 14px;">Todos los montos se muestran en formato chileno: $1.500</p>
                </div>

                <div class="config-section">
                    <h3>üóëÔ∏è Gesti√≥n de Datos</h3>
                    <p>Esta acci√≥n eliminar√° todos los datos almacenados. No se puede deshacer.</p>
                    <button id="reiniciarDatos" class="btn btn--outline">Reiniciar Todos los Datos</button>
                </div>

                <div class="config-section">
                    <h3>‚ÑπÔ∏è Informaci√≥n</h3>
                    <p><strong>Versi√≥n:</strong> 1.0.0</p>
                    <p><strong>Almacenamiento:</strong> <span id="storageInfo">Calculando...</span></p>
                    <p><strong>√öltima actualizaci√≥n:</strong> Noviembre 2025</p>
                </div>
            </div>
        </section>
    </main>

    <!-- Bot√≥n Flotante -->
    <button id="btnFlotante" class="floating-btn" title="Agregar gasto r√°pido">
        <span>+</span>
    </button>

    <!-- Modal para gasto r√°pido -->
    <div id="modalRapido" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="modalRapidoTitle">‚ûï Agregar Gasto R√°pido</h3>
                <button class="modal-close" id="closeModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="gastoRapidoForm">
                    <input type="hidden" id="transaccionIdRapido">
                    <div class="form-group">
                        <label class="form-label">Monto *</label>
                        <input type="number" id="montoRapido" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Descripci√≥n *</label>
                        <input type="text" id="descripcionRapido" class="form-control" list="descripcionesSugeridas" autocomplete="off" required>
                        <datalist id="descripcionesSugeridas"></datalist>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Categor√≠a *</label>
                        <select id="categoriaRapido" class="form-control" required>
                            <option value="">Seleccionar...</option>
                            <option value="Alimentaci√≥n üçû">Alimentaci√≥n üçû</option>
                            <option value="Transporte üöó">Transporte üöó</option>
                            <option value="Entretenimiento üé¨">Entretenimiento üé¨</option>
                            <option value="Salud üíä">Salud üíä</option>
                            <option value="Educaci√≥n üìö">Educaci√≥n üìö</option>
                            <option value="Otro ‚ûï">Otro ‚ûï</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">
                            <input type="checkbox" id="esGastoRapido" checked style="margin-right: 8px;">
                            <span style="font-size: 12px; color: var(--color-text-secondary);">Marcar como gasto r√°pido (editable despu√©s)</span>
                        </label>
                    </div>
                    <div class="modal-actions">
                        <button type="submit" class="btn btn--primary btn--full-width" id="btnGuardarRapido">Agregar Gasto</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Modal de Autenticaci√≥n -->
    <div id="authModal" class="modal auth-modal">
        <div class="modal-content auth-modal-content">
            <div class="auth-modal-header">
                <h2 id="authModalTitle">üîê Bienvenido</h2>
                <p id="authModalSubtitle">Inicia sesi√≥n o crea una cuenta para sincronizar tus datos</p>
            </div>

            <div class="auth-tabs">
                <button class="auth-tab active" data-auth-tab="login">Iniciar Sesi√≥n</button>
                <button class="auth-tab" data-auth-tab="register">Registrarse</button>
            </div>

            <div class="auth-modal-body">
                <!-- Formulario de Login -->
                <form id="loginForm" class="auth-form active">
                    <div class="form-group">
                        <label class="form-label">Correo Electr√≥nico</label>
                        <input type="email" id="loginEmail" class="form-control" placeholder="tu@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contrase√±a</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="loginPassword" class="form-control" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                            <button type="button" class="toggle-password" data-target="loginPassword" title="Mostrar contrase√±a">
                                <span class="eye-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="rememberMe" style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="font-size: 14px; color: #374151;">Recordar datos y mantener sesi√≥n iniciada</span>
                        </label>
                        <p style="font-size: 12px; color: #6b7280; margin: 8px 0 0 26px;">Tus datos se guardar√°n de forma segura en este dispositivo</p>
                    </div>
                    <button type="submit" class="btn btn--primary btn--full-width">Iniciar Sesi√≥n</button>
                    <button type="button" id="continueAnonymous" class="btn btn--secondary btn--full-width" style="margin-top: 12px;">
                        Continuar sin cuenta
                    </button>
                </form>

                <!-- Formulario de Registro -->
                <form id="registerForm" class="auth-form">
                    <div class="form-group">
                        <label class="form-label">Nombre</label>
                        <input type="text" id="registerName" class="form-control" placeholder="Tu nombre" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Correo Electr√≥nico</label>
                        <input type="email" id="registerEmail" class="form-control" placeholder="tu@email.com" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Contrase√±a</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="registerPassword" class="form-control" placeholder="M√≠nimo 6 caracteres" required minlength="6">
                            <button type="button" class="toggle-password" data-target="registerPassword" title="Mostrar contrase√±a">
                                <span class="eye-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Confirmar Contrase√±a</label>
                        <div class="password-input-wrapper">
                            <input type="password" id="registerPasswordConfirm" class="form-control" placeholder="Repite tu contrase√±a" required>
                            <button type="button" class="toggle-password" data-target="registerPasswordConfirm" title="Mostrar contrase√±a">
                                <span class="eye-icon">üëÅÔ∏è</span>
                            </button>
                        </div>
                    </div>
                    <div class="form-group" style="margin-top: 16px;">
                        <label class="form-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                            <input type="checkbox" id="rememberMeRegister" checked style="width: 18px; height: 18px; cursor: pointer;">
                            <span style="font-size: 14px; color: #374151;">Recordar datos y mantener sesi√≥n iniciada</span>
                        </label>
                        <p style="font-size: 12px; color: #6b7280; margin: 8px 0 0 26px;">Tus datos se guardar√°n de forma segura en este dispositivo</p>
                    </div>
                    <button type="submit" class="btn btn--primary btn--full-width">Crear Cuenta</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Notificaci√≥n Toast -->
    <div id="toast" class="toast"></div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="js/number-formatting.js"></script>
    <script src="js/sidebar-navigation.js"></script>
    <script src="js/navbar.js"></script>
    <script src="js/historial.js"></script>
    <script type="module" src="js/currency-notifications.js"></script>
    <script type="module" src="js/integration.js"></script>
    <script type="module" src="firebase-config.js"></script>
    <script type="module" src="app.js"></script>

    <!-- Service Worker Registration -->
    <script>
        // Registro del Service Worker para PWA
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('‚úÖ Service Worker registrado:', registration.scope);

                        // Verificar actualizaciones peri√≥dicamente
                        setInterval(() => {
                            registration.update();
                        }, 60000); // Cada minuto
                    })
                    .catch(error => {
                        console.error('‚ùå Error al registrar Service Worker:', error);
                    });
            });

            // Detectar cuando hay una nueva versi√≥n disponible
            navigator.serviceWorker.addEventListener('controllerchange', () => {
                console.log('üîÑ Nueva versi√≥n disponible');
                // Opcional: Mostrar notificaci√≥n al usuario
                if (confirm('Hay una nueva versi√≥n disponible. ¬øDeseas actualizar?')) {
                    window.location.reload();
                }
            });
        }

        // Prompt de instalaci√≥n de PWA
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;

            // Mostrar bot√≥n de instalaci√≥n personalizado si existe
            const installBtn = document.getElementById('installPWABtn');
            if (installBtn) {
                installBtn.style.display = 'block';
                installBtn.addEventListener('click', async () => {
                    if (deferredPrompt) {
                        deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`Usuario eligi√≥: ${outcome}`);
                        deferredPrompt = null;
                        installBtn.style.display = 'none';
                    }
                });
            }
        });

        // Detectar cuando la app fue instalada
        window.addEventListener('appinstalled', () => {
            console.log('‚úÖ PWA instalada exitosamente');
            deferredPrompt = null;
        });

        // Detectar estado de conexi√≥n
        function updateOnlineStatus() {
            const statusElement = document.getElementById('onlineStatus');
            if (statusElement) {
                if (navigator.onLine) {
                    statusElement.textContent = 'üü¢ Online';
                    statusElement.style.color = '#10b981';
                } else {
                    statusElement.textContent = 'üî¥ Offline';
                    statusElement.style.color = '#ef4444';
                }
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        window.addEventListener('load', updateOnlineStatus);
    </script>
    </div>
    <!-- Fin app-content -->
</body>
</html>